![[Pasted image 20251216212745.png]]

根据图片中提到的“可能会考但尚未考过的题型”，重点集中在 **TCP 建立连接**、**TCP 其他问题（如可靠传输、流量控制）** 以及 **UDP**。

为了帮助你备考，我针对这三个方向分别设计了不同难度的习题（包括选择题、简答题和分析题），并附带了详细解析。

---

### 第一部分：TCP 建立连接 (重点)

这部分通常考察“三次握手”的细节，包括标志位（SYN, ACK）的变化和序号（Seq, ack）的变化。

#### 习题 1：三次握手细节（分析题）
**题目：** 主机 A 向主机 B 发起 TCP 连接。
1. 主机 A 发送的第一个报文段中，SYN = 1, seq = $x$。
2. 主机 B 收到后同意连接，发送第二个报文段。
3. 主机 A 收到 B 的确认后，发送第三个报文段。
**请问：** 在主机 B 发送的报文段中，SYN、ACK 标志位的值分别是多少？确认号（ack）是多少？在主机 A 发送的第三个报文段中，seq 和 ack 分别是多少？

**答案与解析：**
*   **主机 B 发送的报文（第二次握手）：**
    *   **SYN = 1, ACK = 1**。 (SYN=1表示这是一个连接请求/接受报文)。
    *   **ack = $x + 1$**。 (确认号是对收到数据的确认，期望收到对方的下一个序号。SYN 占用一个序号，所以是 $x+1$)。
    *   *注：B 也会生成自己的序号 seq = $y$。*
*   **主机 A 发送的报文（第三次握手）：**
    *   **SYN = 0, ACK = 1**。 (连接已建立，不再需要 SYN)。
    *   **seq = $x + 1$**。 (A 的下一个数据序号)。
    *   **ack = $y + 1$**。 (A 确认收到了 B 的 SYN，所以期望收到 B 的 $y+1$)。

#### 习题 2：为什么是三次握手（简答题）
**题目：** 为什么 TCP 建立连接需要“三次握手”，而不是“两次握手”？如果不进行第三次握手会产生什么后果？

**答案与解析：**
*   **核心原因：** 防止**已失效的连接请求报文段**突然又传送到了服务端，因而产生错误。
*   **场景描述：** 假设改为两次握手。客户端发出的第一个连接请求报文在网络中滞留了，客户端超时重发并建立了连接，数据传输完后关闭。
*   **后果：** 那个滞留的“旧请求”后来到达了服务器。如果是两次握手，服务器收到后会误以为客户端又要建立新连接，于是向客户端发送确认并进入 ESTABLISHED 状态。但客户端并没有发出新请求，因此丢弃服务器的确认，也不发送数据。
*   **资源浪费：** 此时服务器一直等待客户端发送数据，导致服务器资源白白浪费。三次握手通过客户端的再一次确认（第三次），解决了这个问题。

---

### 第二部分：TCP 的其他问题 (可靠性、控制机制)

这部分可能考察 TCP 如何保证可靠性、流量控制（滑动窗口）和拥塞控制。

#### 习题 3：流量控制与滑动窗口（计算题/选择题）
**题目：** 主机 A 向主机 B 发送数据。主机 B 告诉主机 A，我的接收窗口（rwnd）大小为 4000 字节。主机 A 当前的拥塞窗口（cwnd）为 3000 字节。请问主机 A 的**发送窗口**大小应该是多少？
A. 4000 字节
B. 3000 字节
C. 7000 字节
D. 1000 字节

**答案与解析：**
*   **答案：B (3000 字节)**
*   **解析：** TCP 的发送窗口大小取决于接收方的处理能力（接收窗口 rwnd）和网络的拥塞程度（拥塞窗口 cwnd）。发送窗口的计算公式是：**$min(rwnd, cwnd)$**。
*   因为 $min(4000, 3000) = 3000$，所以发送窗口取较小值 3000。

#### 习题 4：拥塞控制算法（填空/简答题）
**题目：** TCP 的拥塞控制主要有四个算法，分别是慢开始（Slow Start）、拥塞避免（Congestion Avoidance）、快重传（Fast Retransmit）和快恢复（Fast Recovery）。
当发送方连续收到 **___个重复的 ACK** 时，会触发“快重传”算法，此时发送方会认为网络没有发生严重拥塞，而是个别报文丢失，从而执行 **___** 算法，而不是重新进入慢开始。

**答案与解析：**
*   **第一个空：3** (3个重复的 ACK，加上原来的 1 个 ACK，总共收到 4 次对同一个序号的确认)。
*   **第二个空：快恢复 (Fast Recovery)**。
*   **解析：** 收到 3 个重复 ACK 说明后续报文到达了，只是中间丢了一个，网络并未完全瘫痪。因此不将 cwnd 降为 1（慢开始），而是将 cwnd 减半（或类似操作），进入快恢复阶段。

---

### 第三部分：UDP (用户数据报协议)

由于图片提到 UDP 也是考点，这里主要考察 UDP 的特性及其与 TCP 的区别。

#### 习题 5：UDP 首部开销（选择题）
**题目：** 用户数据报协议 UDP 的首部开销是固定的，请问 UDP 的首部长度是多少字节？作为对比，TCP 的最小首部长度是多少字节？
A. 8 字节; 20 字节
B. 20 字节; 20 字节
C. 8 字节; 60 字节
D. 16 字节; 20 字节

**答案与解析：**
*   **答案：A**
*   **解析：**
    *   **UDP 首部：** 非常简单，只有 4 个字段（源端口、目的端口、长度、检验和），每个字段 2 字节，共 **8 字节**。
    *   **TCP 首部：** 固定部分是 **20 字节**（如果有选项字段会更长，最大 60 字节）。
    *   这体现了 UDP 的高效和低延迟特性。

#### 习题 6：TCP 与 UDP 的区别（综合判断题）
**题目：** 判断下列应用场景分别适合使用 TCP 还是 UDP：
1.  网页浏览（HTTP/HTTPS）
2.  实时视频会议（Zoom/Skype）
3.  文件传输（FTP）
4.  域名系统（DNS）

**答案与解析：**
1.  **网页浏览 -> TCP** (需要保证网页数据完整，不能丢包，否则页面显示错误)。
2.  **实时视频会议 -> UDP** (更看重实时性。偶尔丢几帧画面是可以接受的，但不能卡顿等待重传)。
3.  **文件传输 -> TCP** (文件必须 100% 正确，不能丢失任何比特)。
4.  **域名系统 (DNS) -> 通常是 UDP** (查询速度快，包小，开销小。注：DNS 在区域传输时也会用 TCP，但基础查询多用 UDP)。

#### 习题 7：UDP 的不可靠性（简答题）
**题目：** UDP 是“不可靠”的协议，这是否意味着使用 UDP 传输数据一定会频繁丢包？如果应用层需要可靠传输但底层必须用 UDP（如 QUIC 协议），该怎么办？

**答案与解析：**
*   **是否频繁丢包：** 不一定。UDP 的“不可靠”是指协议本身**不保证**数据送达（无确认、无重传机制），也不保证顺序。但在网络状况良好的局域网或光纤中，UDP 的丢包率极低。
*   **如何实现可靠：** 如果底层用 UDP 但上层需要可靠，必须在**应用层**实现可靠传输机制。
    *   例如：应用层自己添加序列号、确认机制（ACK）、超时重传算法等。Google 的 QUIC 协议就是基于 UDP 但在应用层实现了类似 TCP 的可靠性控制。

---

### 总结备考建议

针对图片中的提示，建议你在复习时：
1.  **手画一次 TCP 三次握手图**，标记清楚 SYN, ACK, seq, ack 的数值关系。
2.  **背诵 UDP 的 8 字节首部结构**，并记住它没有拥塞控制，面向报文（不拆分也不合并应用层给的数据）。
3.  **理解**为什么 TCP 适合传文件，UDP 适合打游戏/看直播。