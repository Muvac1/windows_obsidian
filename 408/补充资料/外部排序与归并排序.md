#外部排序的核心 在于如何 最小化磁盘 I/O (Input/Output) 次数 。因为相比于内存访问，磁盘读写的速度要慢上几个数量级，它才是整个排序过程的性能瓶颈。  [[外部排序的IO成本判断]] 

外部排序通常采用一种称为 **“排序-合并” (Sort-Merge)** 的策略，而这个策略的基础就是归并排序。整个过程分为两个主要阶段：

*   **阶段一：生成初始顺串 (Sorting Phase)**
    1.  从磁盘上的大文件中读取一部分数据，这部分数据的大小正好可以放入内存（例如，内存有 1GB，就读取 1GB 的数据）。
    2.  在内存中使用高效的内部排序算法（如快速排序）对这部分数据进行排序。
    3.  将排好序的这部分数据写回到磁盘上的一个临时文件中。这个排好序的临时文件就是一个“初始顺串”。
    4.  重复以上步骤，直到原始的 10TB 文件被全部分割成若干个有序的初始顺串。

    例如，如果内存有 10GB，那么 10TB 的文件会被分成 $10 \text{ TB} / 10 \text{ GB} = 10 \times 1024 \text{ GB} / 10 \text{ GB} = 1024$ 个排好序的、大小为 10GB 的临时文件。

*   **阶段二：多路归并 (Merging Phase)**
    1.  现在磁盘上有了很多个有序的顺串。下一步是将它们合并成一个最终的有序文件。
    2.  为了高效合并，我们采用 **k-路归并** 的方法。系统开辟 k 个输入缓冲区和一个输出缓冲区。
    3.  从 k 个顺串中各读取一小块数据到对应的输入缓冲区。
    4.  然后，在内存中比较这 k 个顺串的当前最小元素，找出其中最小的一个，将其放入输出缓冲区。
    5.  从被选中最小元素的那个顺串中，再读入下一个元素。
    6.  重复步骤 4 和 5，直到输出缓冲区被填满，然后将输出缓冲区的内容一次性写入最终的排序文件。
    7.  这个过程一直持续，直到所有的顺串都被合并完毕。

    这个归并过程是顺序读取各个临时文件，顺序写入最终文件，极大地减少了磁盘的随机寻道时间，从而提高了效率。

#### 2. 为什么归并排序适合外部排序？

归并排序的“合并”操作天然地支持顺序读写。在合并阶段，我们只需要从每个顺串的头部顺序地读取数据进行比较，并将结果顺序地写入到输出文件中。这种对磁盘的顺序访问模式远比快速排序等算法的随机访问模式要高效得多。
