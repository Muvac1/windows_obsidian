#FTP的主动模式与被动模式
数据连接的建立方式有两种：

1.  **主动模式 (Active Mode)**
    *   **流程**：
        1.  客户端从一个随机端口 $N$ (通常 > 1023) 连接到服务器的 **21** 端口（建立控制连接）。
        2.  客户端开始监听端口 $N+1$。
        3.  客户端通过控制连接发送 `PORT N+1` 命令，告诉服务器：“我已经在 $N+1$ 端口准备好了，请你来连接我”。
        4.  服务器收到命令后，从自己的 **20** 端口主动发起连接，去连接客户端的 $N+1$ 端口（建立数据连接）。
    *   **结论**：在主动模式下，是**服务器从它的20端口**去连接客户端的一个高位端口。

2.  **被动模式 (Passive Mode)**
    *   **流程**：
        1.  客户端从一个随机端口 $N$ 连接到服务器的 **21** 端口（建立控制连接）。
        2.  客户端通过控制连接发送 `PASV` 命令。
        3.  服务器收到命令后，在本地打开一个随机的高位端口 $P$ (通常 > 1023) 进行监听。
        4.  服务器通过控制连接将这个端口号 $P$ 告诉客户端。
        5.  **客户端**从自己的 $N+1$ 端口主动发起连接，去连接服务器的 $P$ 端口（建立数据连接）。
    *   **结论**：在被动模式下，数据连接完全不使用服务器的20端口。
- 
- 主动模式 vs. 被动模式的应用场景（防火墙/NAT问题） 
	-  **考点**：为什么需要被动模式？
    *   **详解**：在主动模式下，服务器需要主动连接客户端。如果客户端位于一个防火墙或NAT（网络地址转换）设备后面，防火墙通常会阻止来自外部网络的未知连接请求。因此，服务器从20端口发起的连接请求会被客户端的防火墙拦截，导致数据连接建立失败。
    *   被动模式解决了这个问题。因为在被动模式下，控制连接和数据连接都是由**客户端**发起的，这对于防火墙来说是“允许”的（允许内部向外部发起的连接），所以更容易穿透防火墙。这是非常高频的考点。