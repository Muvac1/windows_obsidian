
#ARP的工作流程 

假设主机 A (IP: `192.168.1.10`, MAC: `AA-AA-AA-AA-AA-AA`) 要与同一局域网内的主机 B (IP: `192.168.1.20`) 通信。

1.  **检查 ARP 缓存**：主机 A 首先会检查自己的 #ARP缓存表 (ARP Cache)**，看是否已经有 `192.168.1.20` 对应的 MAC 地址记录。如果存在，则直接使用该 MAC 地址封装数据帧并发送，流程结束。

2.  **发送 ARP 请求 (Request)**：如果在缓存中没有找到记录，主机 A 会在局域网内广播一个 **ARP 请求**帧。这个请求帧的关键内容是：
    *   **源 IP 地址**: `192.168.1.10`
    *   **源 MAC 地址**: `AA-AA-AA-AA-AA-AA`
    *   **目标 IP 地址**: `192.168.1.20`
    *   **目标 MAC 地址**: `00-00-00-00-00-00` (因为这就是想查询的信息)
    *   这个帧的目标 MAC 地址是一个**广播地址** (`FF-FF-FF-FF-FF-FF`)，确保局域网内所有设备都能收到。

3.  **处理 ARP 请求**：局域网内的所有设备都会收到这个广播帧。
    *   除主机 B 外的其他设备，在检查到 ARP 请求中的“目标 IP 地址”与自己的 IP 地址不符后，会直接丢弃这个数据包。
    *   主机 B 发现目标 IP 地址是自己的，它就会处理这个请求。

4.  **发送 ARP 回复 (Reply)**：主机 B 会向主机 A 发送一个 **ARP 回复**帧。这是一个**单播**帧，直接发给主机 A。这个回复帧的关键内容是：
    *   **源 IP 地址**: `192.168.1.20`
    *   **源 MAC 地址**: `BB-BB-BB-BB-BB-BB` (主机 B 的 MAC 地址)
    *   **目标 IP 地址**: `192.168.1.10`
    *   **目标 MAC 地址**: `AA-AA-AA-AA-AA-AA` (从 ARP 请求中获知)
    *   同时，主机 B 也会将主机 A 的 IP 和 MAC 地址对 (`192.168.1.10` -> `AA-...-AA`) 存入自己的 ARP 缓存中，以备后用。

5.  **更新缓存并通信**：主机 A 收到 ARP 回复后，就知道了 `192.168.1.20` 对应的 MAC 地址是 `BB-BB-BB-BB-BB-BB`。它会将这个映射关系存入自己的 ARP 缓存表，并用这个 MAC 地址来封装数据帧，开始与主机 B 的正常通信。