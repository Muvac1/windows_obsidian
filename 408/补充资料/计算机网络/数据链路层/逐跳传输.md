#逐跳传输 (Hop-by-Hop) - “快递接力”的过程

逐跳传输描述的是数据包离开主机2后，如何在路由器之间一站一站地“接力”，最终到达目的地。**核心思想是：IP地址指引全局方向，MAC地址负责每段路的具体运送**。

让我们继续上面的例子，看看这个帧离开主机2之后发生了什么：

#### 第一跳 (Hop 1): 从 主机2 到 路由器

*   交换机收到来自主机2的帧，查看其目的MAC地址是 `00-a1-a1-a1-a1-a1`，于是将该帧转发给路由器。
*   **此时的地址**:
    *   **IP层面 (包裹运单)**: 源IP: 主机2, 目的IP: Internet服务器  **(不变)**
    *   **MAC层面 (运输车)**: 源MAC: 主机2, 目的MAC: 路由器

#### 在路由器内部的处理 - “中转站拆包再打包”

1.  **接收并拆包 (De-encapsulation)**: 路由器收到这个以太网帧。它看到目的MAC是自己的，于是接收下来。然后，它会“拆开”以太网帧的包装，丢掉帧头和帧尾，取出里面的 **IP包**。
2.  **查询路由表 (问路)**: 路由器查看IP包的目的IP地址（Internet服务器的IP）。它会查询自己的路由表，寻找去往这个目的IP的最佳路径（下一站该去哪）。假设路由表告诉它，下一站是ISP（互联网服务提供商）的另一个路由器。
3.  **重新打包 (Re-encapsulation)**: 路由器将**原始的IP包**（它不会修改IP包内容，只会将TTL字段减1）用**一个全新的以太网帧**重新打包。
    *   **新的源MAC地址**: 路由器连接ISP的那个网络接口的MAC地址。
    *   **新的目的MAC地址**: 下一跳ISP路由器的MAC地址。

#### 第二跳 (Hop 2): 从 本地路由器 到 ISP路由器

*   路由器将这个**新**的帧发送出去。
*   **此时的地址**:
    *   **IP层面 (包裹运单)**: 源IP: 主机2, 目的IP: Internet服务器  **(仍然不变!)**
    *   **MAC层面 (换了辆新运输车)**: 源MAC: 本地路由器, 目的MAC: ISP路由器

这个“拆包 -> 查路由 -> 重新打包 -> 发送”的过程，在每一台中间的路由器（每一跳）上都会重复发生。IP包就像一个信件，在每个邮局（路由器）被从一个邮袋（帧）里拿出，再放进发往下一个城市的另一个邮袋（新的帧）里。

直到最后一跳，数据包到达了目标服务器所在的局域网，该网络的路由器会最终将数据封装成一个目的MAC为目标服务器MAC地址的帧，完成最终的投递。

### 总结与关联题目

| 地址类型 | 特点                                           | 在传输过程中的变化             | 好比是...            |
| :------- | :--------------------------------------------- | :----------------------------- | :------------------- |
| **IP地址** | 逻辑地址，负责标识通信的**最终起点和终点**     | **基本不变**                   | **包裹上的最终收件地址** |
| **MAC地址** | 物理地址，负责标识**同一网络内下一跳**的具体设备 | **在每一跳（经过路由器时）都改变** | **每一段路的货车司机**   |