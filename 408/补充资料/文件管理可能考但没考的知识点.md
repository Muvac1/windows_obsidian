![[Pasted image 20251216205420.png]]

### 第一部分：文件的分配方式（连续、链式、索引）

这部分主要考察三种方式在**存取速度**、**空间利用率**（碎片问题）以及**文件扩展性**方面的对比。

#### 【习题】

**1. (选择题) 若某文件系统要求能够支持随机访问（即直接跳转到文件中间某处读取），且文件大小经常动态增长，下列哪种分配方式最不适合？**
A. 连续分配
B. 隐式链接分配
C. 索引分配
D. 显式链接分配（如FAT）

**2. (选择题) 关于文件分配方式产生的碎片问题，以下说法正确的是：**
A. 连续分配不会产生外部碎片，但会产生内部碎片
B. 链式分配既没有外部碎片，也没有内部碎片（假设指针占用空间忽略不计）
C. 索引分配的主要缺点是会产生大量的外部碎片
D. 连续分配会产生外部碎片，需通过“紧凑”来解决

**3. (计算题) 设文件索引节点中有 10 个直接块地址指针，1 个一级间接块指针，1 个二级间接块指针。磁盘块大小为 4KB，每个块地址指针占 4 字节。请问该系统支持的最大文件大小是多少？**

---

#### 【答案与解析】

**1. 答案：B**
*   **解析：**
    *   **连续分配：** 支持随机访问，但不利于文件动态增长（需要移动大量数据或找不到足够连续空间）。
    *   **隐式链接分配：** **不支持随机访问**（必须从头遍历指针），且只适合顺序访问，虽然利于增长，但随机访问效率极低，符合题目“最不适合”。
    *   **索引分配：** 支持随机访问，也易于扩展。
    *   **显式链接（FAT）：** 虽然也是链式，但表在内存中，检索较快，勉强支持类似随机的访问，比隐式好。

**2. 答案：D**
*   **解析：**
    *   **A/D：** 连续分配要求磁盘上连续空间，很容易产生**外部碎片**（磁盘上有空间但被切分得太小无法使用），需要“紧凑（Defragmentation）”。
    *   **B：** 链式分配以块为单位，没有外部碎片，但如果最后一个块没填满，会有**内部碎片**。
    *   **C：** 索引分配主要缺点是**索引表本身占用存储空间**，而不是外部碎片。

**3. 答案：约 4GB (准确值为 4,198,440 KB)**
*   **解析：**
    *   一个块能存的指针数量 = $4KB / 4B = 1024$ 个。
    *   **直接寻址范围：** $10 \times 4KB = 40KB$
    *   **一级间接范围：** $1 \times 1024 \times 4KB = 4MB$
    *   **二级间接范围：** $1 \times 1024 \times 1024 \times 4KB = 4GB$
    *   **总大小：** $4GB + 4MB + 40KB \approx 4GB$。

---

### 第二部分：空闲空间的组织方式

这部分主要考察**空闲表法**、**空闲链表法**、**位示图法**和**成组链接法**的特点及计算。

#### 【习题】

**1. (选择题) 在UNIX系统中，管理磁盘空闲块主要采用的方法是：**
A. 空闲表法
B. 空闲链表法
C. 位示图法
D. 成组链接法

**2. (计算题) 某文件系统采用位示图（Bitmap）法管理空闲空间。磁盘总容量为 80GB，盘块大小为 4KB。若位示图中的每一位（bit）对应一个盘块，则位示图本身需要占用多少个盘块？**

---

#### 【答案与解析】

**1. 答案：D**
*   **解析：** UNIX系统（尤其是System V）经典的文件系统采用**成组链接法**。它结合了空闲链表和堆栈的思想，适合大型文件系统，分配和回收效率高。
    *   注：现代某些Linux文件系统（如ext2/3/4）会使用位示图，但经典教材中UNIX对应的是成组链接法。

**2. 答案：640 个盘块**
*   **解析：**
    1.  **计算总块数：** $80GB / 4KB = 20 \times 10^6$ 个盘块（这里简化 $1GB=10^9$, 若按 $2^{30}$ 算则需相应换算，通常考研或考试按 $20M$ 估算或严格按 $2^{xx}$ 计算，这里按逻辑演示）。
        *   严格按 $2$ 进制：$80 \times 2^{30} / (4 \times 2^{10}) = 20 \times 2^{20}$ 块。
    2.  **计算所需位数：** 需要 $20 \times 2^{20}$ 个 bit。
    3.  **换算成字节：** $(20 \times 2^{20}) / 8$ Bytes。
    4.  **换算成盘块数：** 字节数 / 4KB。
        *   公式化简：所需盘块数 = $\frac{\text{总块数}}{\text{每块位数}}$
        *   每块位数 = $4KB \times 8 = 32768$ bits。
        *   所需盘块 = $(20 \times 1024 \times 1024) / 32768 = 640$ 个。

---

### 第三部分：硬链接和软链接的其他特点

这部分主要考察**inode（索引节点）**、**引用计数**、**跨文件系统**以及**目录链接**的区别。

#### 【习题】

**1. (分析题) 用户 A 创建了一个文件 `file1`，用户 B 创建了一个指向 `file1` 的硬链接 `file2`，用户 C 创建了一个指向 `file1` 的软链接（符号链接）`file3`。**
    *   (1) 如果用户 A 删除了 `file1`，`file2` 和 `file3` 的访问情况分别如何？
    *   (2) 如果 `file1` 的内容被修改，`file2` 和 `file3` 看到的内容会变化吗？

**2. (选择题) 关于硬链接和软链接的区别，下列说法错误的是：**
A. 硬链接不能跨越不同的文件系统，而软链接可以
B. 硬链接本质上是同一个文件有多个别名，它们共享同一个 inode
C. 软链接拥有自己的 inode，其数据块中存储的是原文件的路径
D. 超级用户可以给目录创建硬链接，普通用户也可以随意给目录创建硬链接

---

#### 【答案与解析】

**1. 答案与解析：**
*   **(1) file2 仍可访问，file3 失效。**
    *   **原理：**
        *   **硬链接：** `file1` 和 `file2` 指向同一个 inode。删除 `file1` 只是删除了一个目录项，并将 inode 的**引用计数（count）**减 1。只要计数不为 0，数据和 inode 就保留，所以 `file2` 依然可用。
        *   **软链接：** `file3` 是一个独立文件，里面存的是 `file1` 的路径。删除 `file1` 后，`file3` 存储的路径指向空，变成“断链”。
*   **(2) 都会变化。**
    *   **原理：** 无论是硬链接还是软链接，最终指向的都是同一份物理数据。硬链接直接指，软链接通过路径间接指。源数据变了，大家看到的都变。

**2. 答案：D**
*   **解析：**
    *   **A 正确：** 硬链接依赖 inode 编号，不同文件系统 inode 编号不互通，所以不能跨。软链接存的是路径字符串，所以可以跨。
    *   **B 正确：** 这是硬链接的定义。
    *   **C 正确：** 软链接是一个独立的小文件。
    *   **D 错误：** **普通用户通常不允许对目录创建硬链接**（防止造成目录环路，导致文件系统遍历死循环）。即使是超级用户，现代系统也极少使用目录硬链接。软链接则允许用于目录。