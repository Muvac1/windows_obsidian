

#二叉树的编号
这个“编号”指的是**层序遍历（Level-Order Traversal）编号**。

对一个完全二叉树，我们按照以下规则给它的每个结点从1开始编号：

1.  **从上到下**：按树的层级，从根结点开始。
2.  **从左到右**：在同一层内，从左边的结点到右边的结点。

**规则图解：**

```
        1      <-- 第1层
       / \
      2   3    <-- 第2层
     / \ / \
    4  5 6  7   <-- 第3层
   / \
  8   9        <-- 第4层
```

在这个例子中：
*   根结点的编号永远是 **1**。
*   第2层的结点从左到右依次是 **2** 和 **3**。
*   第3层的结点从左到右依次是 **4, 5, 6, 7**。
*   以此类推。

这个编号方式非常重要，因为它使得我们可以用一个**数组**来高效地存储一棵完全二叉树，数组的下标就对应着结点的编号。

### 2. 为什么最后一个非叶子结点是 $⌊n/2⌋$？

这个性质源于层序编号带来的父子关系：

对于一个编号为 `i` 的结点：
*   它的**左子结点**的编号是 `2 * i`。
*   它的**右子结点**的编号是 `2 * i + 1`。

现在，我们来推导这个结论：
*   假设树中一共有 `n` 个结点，那么最后一个结点的编号就是 `n`。
*   这个编号为 `n` 的结点，必然是某个父结点 `p` 的子结点。
*   根据上面的父子关系，`p` 的编号可以通过 `n` 来反推：`p = ⌊n/2⌋`。
    *   如果 `n` 是左子结点，则 `n = 2 * p`，所以 `p = n / 2`。
    *   如果 `n` 是右子结点，则 `n = 2 * p + 1`，所以 `p = (n - 1) / 2`。
    *   这两种情况合并起来，就是 `p = ⌊n/2⌋` (向下取整)。
*   因为编号为 `n` 的是树中**最后一个**结点，那么它的父结点 `p = ⌊n/2⌋` 必然是所有父结点中**编号最大的那一个**，也就是“最后一个非叶子结点”。
*   任何编号 `j` 如果大于 `⌊n/2⌋`，那么它的左子结点的编号将是 `2 * j > 2 * (n/2) = n`。由于树中最大的编号就是 `n`，所以编号大于 `n` 的结点不存在。因此，所有编号大于 `⌊n/2⌋` 的结点都不可能有子结点，它们全是叶子结点。

**举例说明：**

*   **当 n = 7 时** (如上图的1-7结点)
    *   最后一个非叶子结点的编号是 $⌊7/2⌋ = 3$。
    *   我们看树，非叶子结点有1, 2, 3。最后一个确实是3。
    *   所有编号大于3的结点（4, 5, 6, 7）都是叶子结点。

*   **当 n = 6 时**
    *   树的结构是：
        ```
              1
             / \
            2   3
           / \ /
          4  5 6
        ```
    *   最后一个非叶子结点的编号是 $⌊6/2⌋ = 3$。
    *   我们看树，非叶子结点有1, 2, 3。最后一个确实是3（结点3只有左孩子6）。
    *   所有编号大于3的结点（4, 5, 6）都是叶子结点。

### 3. “这个结点包括根节点吗？”

**是的，这个性质的讨论范围包括根结点。**

根结点的编号是 **1**。

*   **非叶子结点**（也叫分支结点）是指**至少有一个子结点**的结点。
*   **叶子结点**是指**没有子结点**的结点。

我们来看几种情况：
*   **如果 n = 1**：树只有一个根结点。它没有子结点，所以是叶子结点。此时 $⌊1/2⌋ = 0$，没有非叶子结点，结论成立。
*   **如果 n = 2 或 n = 3**：
    *   树的结构是 `1 -> 2` 或 `1 -> (2, 3)`。
    *   此时，只有根结点1是非叶子结点。
    *   计算 $⌊2/2⌋ = 1$ 和 $⌊3/2⌋ = 1$。
    *   在这种情况下，**根结点1本身就是“最后一个非叶子结点”**。
*   **如果 n > 3**：
    *   根结点1一定是非叶子结点，但它不一定是“最后一个”非叶子结点。例如，当 n=7 时，最后一个非叶子结点是3，而不是1。

**总结：**

1.  **编号**：指的是从根结点开始，自上而下、自左而右的**层序编号**，从1开始。
2.  **$⌊n/2⌋$**：这是树中**最后一个有孩子的结点**（非叶子结点）的编号。所有编号比它大的结点，都是叶子结点。
3.  **根结点**：根结点（编号1）**是第一个非叶子结点**（只要n>1）。它也可能是最后一个非叶子结点（当n=2或3时）。所以，这个性质的讨论范围是包含根结点的。

这个性质在**堆（Heap）**这种数据结构中非常重要，因为堆就是用数组表示的完全二叉树，建堆（Heapify）操作就是从最后一个非叶子结点（$⌊n/2⌋$）开始，向前逐个调整的。