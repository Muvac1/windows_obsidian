B 树是一种自平衡的树数据结构，它维护有序数据并允许以对数时间进行搜索、顺序访问、插入和删除。它通常用于数据库和文件系统。
*   **B树（B-Tree）** [[B树（B-树）]]
    *   **定义**：一种多路（multi-way）平衡查找树，即每个节点可以有两个以上的子节点。它专门为磁盘等外部存储设备设计，因为磁盘I/O操作远慢于内存访问，B树通过减少树的高度来降低I/O次数。
    *   **特点**：
        *   所有叶子节点都在同一层。
        *   每个非叶子节点可以存储多个键和指向子节点的指针。
    *   **应用**：绝大多数现代文件系统和数据库系统的索引结构，如MySQL的InnoDB引擎。

![[Pasted image 20250805052805.png]]
对于一棵 **$m$ 阶 (order $m$)** 的 B 树，它具有以下性质：

1.  **根节点 (Root Node)**：
    *   除非树只有一个节点（即根节点也是叶子节点），否则根节点至少有 2 个子节点。
    *   根节点包含的 #关键字 数量范围是 $[1, m-1]$。

2.  **内部节点 (Internal Nodes)**：
    *   除根节点外的所有非叶子节点，其子节点数量范围是 $[\lceil m/2 \rceil, m]$。
    *   其包含的关键字数量范围是 $[\lceil m/2 \rceil - 1, m-1]$。

3.  **叶子节点 (Leaf Nodes)**：
    *   所有叶子节点都位于同一层级（这是 B 树保持平衡的关键）。
    *   叶子节点包含的关键字数量范围与内部节点相同，即 $[\lceil m/2 \rceil - 1, m-1]$。

4.  **通用性质**：
    *   每个节点中的关键字都按升序排列。
    *   如果一个节点有 $k$ 个关键字，那么它就有 $k+1$ 个指向子节点的指针。

#B树的删除操作 
	B-树的删除比插入要复杂，主要分为两种情况：

*   **情况一：删除的关键字在叶子结点中**
    *   **a) 直接删除**：如果删除该关键字后，结点中的关键字数量仍然 $\ge ceil(m/2) - 1$，则删除操作完成。
    *   **b) 删除后下溢**：如果删除后结点发生下溢，则需要再平衡，此时又有两种子情况：
        *   **兄弟够借（旋转）**：如本题所示，如果相邻兄弟结点有多余的关键字，通过父结点进行旋转，从兄弟借一个关键字过来。
        *   **兄弟不够借（合并）**：如果相邻兄弟结点也都只有最少的关键字，则将下溢结点、父结点中的一个分隔关键字、以及一个兄弟结点合并。这个合并操作可能会导致父结点下溢，问题会向上传播，最坏情况下可能导致树的高度减1。

*   **情况二：删除的关键字在非叶子结点中**
    *   如果要删除的关键字 $K$ 在非叶子结点中，不能直接删除。
    *   需要用 $K$ 的**前驱**或**后继**关键字来替换 $K$。
    *   $K$ 的前驱是其左子树中的最大关键字，$K$ 的后继是其右子树中的最小关键字。它们必定位于叶子结点。
    *   替换后，问题就转化为删除叶子结点中的前驱（或后继）关键字，回到了**情况一**。