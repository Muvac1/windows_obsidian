![[Pasted image 20251216213934.png]]


### 知识点一：不同 RAID 下的磁盘读写速度的计算问题

**【模拟题】**
假设有一个由 4 块硬盘组成的磁盘阵列，每块硬盘的平均连续读取速度为 $100 \text{MB/s}$，平均连续写入速度为 $100 \text{MB/s}$。请计算在以下两种 RAID 级别下，理论上的最大连续读取和写入带宽分别是多少？
(1) RAID 0
(2) RAID 1
(3) RAID 5

**【参考答案与解析】**

1.  **RAID 0 (条带化):**
    *   **原理：** 数据被分割并并行地读写到所有磁盘上。
    *   **读取速度：** $N \times V_{\text{single}} = 4 \times 100 = 400 \text{MB/s}$。
    *   **写入速度：** $N \times V_{\text{single}} = 4 \times 100 = 400 \text{MB/s}$。
    *   *考点：RAID 0 追求最高性能，无冗余。*

2.  **RAID 1 (镜像):**
    *   **原理：** 数据同时写入两块（或多块）盘，互为备份。这里假设是标准的2组镜像或全镜像（视控制器策略，通常考题指 $N$ 块盘互为镜像或两两镜像）。若 4 块盘做 RAID 1（通常指 RAID 10 或 4 块盘互为镜像，这里按最基础的“多盘镜像同一份数据”理解，即有效容量为1块盘）：
    *   **读取速度：** 理论上可以并行从 4 块盘读取不同的数据块，速度可达 $400 \text{MB/s}$（取决于控制器优化），但在保守计算题中，有时也按单盘速度算。**标准答案通常倾向于：** 如果控制器支持并行读取，$N \times V$；如果不支持，则为 $V$。**最常见的考法是 RAID 1 的写入速度。**
    *   **写入速度：** 必须同时写入所有磁盘，取决于最慢的那块盘，即 $100 \text{MB/s}$。

3.  **RAID 5 (分布式奇偶校验):**
    *   **原理：** 数据和校验位分布在所有盘上。容量为 $N-1$。
    *   **读取速度：** 理论上可以从 $N-1$ 块盘并行读取数据（校验位不需要读），或者 $N$ 块盘一起读。一般理论最大带宽按 $N-1$ 算比较稳妥，即 $3 \times 100 = 300 \text{MB/s}$ （也有观点认为是 $400$，但考虑到校验数据的剥离，通常按有效数据吞吐量算）。
    *   **写入速度：** 这是难点。RAID 5 写入需要“读旧数据 -> 读旧校验 -> 计算新校验 -> 写新数据 -> 写新校验”。虽然有 4 块盘，但受限于校验计算和写惩罚，理论峰值通常按 $(N-1) \times V$ 计算连续写入带宽（理想流水线状态），即 $300 \text{MB/s}$。
    *   *注意：如果是随机小文件写入，RAID 5 性能会急剧下降，但计算题通常考连续大文件吞吐量。*

---

### 知识点二：其他 IO 方式的特点（主要是通道控制方式）

**【模拟题】**
下列关于通道（I/O Channel）控制方式的描述中，错误的是（ ）？
A. 通道程序存放在主存中
B. 通道具有执行 I/O 指令的能力，因此它是一台独立的处理器
C. 通道控制方式极大地提高了 CPU 的效率，实现了 CPU 与 I/O 的并行工作
D. 相比于 DMA 方式，通道方式可以处理更复杂的 I/O 操作，且一次可以控制多台设备

**【参考答案】** **B**

**【解析】**
*   **A 正确：** 通道程序（Channel Program）是由通道指令（CCW）组成的，确实存放在主存中，通道从主存取指执行。
*   **B 错误：** 虽然通道是受限的处理器（I/O Processor），但它执行的是**通道指令**，而不是 CPU 的 I/O 指令。CPU 发送 "启动 I/O" 指令给通道，通道随后独立执行自己的通道程序。
*   **C、D 正确：** 这正是通道的优势。DMA 每次只能控制一个数据块的传送，而通道可以控制多台设备进行多次不同的 I/O 操作。

---

### 知识点三：不同 IO 控制方式下的 CPU 利用率的计算

**【模拟题】**
某计算机的 CPU 主频为 $500 \text{MHz}$。
(1) 假设鼠标以中断方式与 CPU 交互，中断服务程序需 1000 个时钟周期。若鼠标每秒产生 100 次中断，求 CPU 用于鼠标 I/O 的时间百分比。
(2) 假设硬盘以 DMA 方式传送数据，硬盘传输速率为 $4 \text{MB/s}$，DMA 每次传送的数据块大小为 $4 \text{KB}$。DMA 的预处理和后处理（中断服务）总共需要 2000 个时钟周期。求 CPU 用于硬盘 I/O 的时间百分比。

**【参考答案与解析】**

**(1) 中断方式（鼠标）:**
*   每秒中断次数：100 次
*   每次中断消耗：1000 周期
*   每秒消耗总周期：$100 \times 1000 = 10^5$ 周期
*   CPU 总周期数：$500 \text{MHz} = 500 \times 10^6$ 周期
*   **CPU 占用率** = $\frac{10^5}{500 \times 10^6} = 0.02\%$

**(2) DMA 方式（硬盘）:**
*   关键点：DMA 只有在“预处理”和“传输结束后的中断”时才占用 CPU，中间传数据时不占 CPU。
*   每秒传送数据量：$4 \text{MB} = 4096 \text{KB}$
*   每次 DMA 块大小：$4 \text{KB}$
*   每秒 DMA 请求次数（中断次数）：$4096 / 4 = 1024$ 次
*   每次 DMA 占用 CPU 周期：2000 周期
*   每秒消耗总周期：$1024 \times 2000 = 2,048,000$ 周期
*   **CPU 占用率** = $\frac{2.048 \times 10^6}{500 \times 10^6} \approx 0.41\%$

---

### 知识点四：DMA 工作流程、虚实地址问题及 Cache 一致性

**【模拟题】**
在配置了虚拟存储器和 Data Cache（采用回写策略 Write-Back）的计算机系统中，当 DMA 控制器将外设（如网卡）的数据写入主存时，为了保证系统的正确性，操作系统或硬件必须完成哪些关键操作？（简答题）

**【参考答案与解析】**

**需要解决两个核心问题：**

1.  **虚实地址转换问题：**
    *   **问题：** DMA 控制器通常直接访问物理内存总线，它不经过 CPU 内部的 MMU（除非系统有 IOMMU）。而程序中给出的缓冲区地址通常是虚拟地址。
    *   **操作：** 操作系统必须在启动 DMA 传输前，将缓冲区的**虚拟地址转换为物理地址**，并将物理地址告知 DMA 控制器。如果缓冲区在物理内存中不连续，还需要构建“散列/聚集列表”给 DMA。同时，操作系统必须**锁定（Pin）**这块物理内存，防止在 DMA 传输期间页面被置换到磁盘。

2.  **Cache 一致性问题：**
    *   **问题：** 采用 Write-Back 策略时，主存中的数据可能不是最新的（新数据在 Cache 中），或者 DMA 写入主存后，Cache 中的旧副本未失效。
    *   **操作（针对 DMA 写主存的情况）：** 如果 DMA 修改了主存中的数据，CPU Cache 中对应的旧数据必须失效（Invalidate）。这通常由硬件（总线监听 Snooping 协议）自动完成。
    *   **操作（针对 DMA 读主存的情况）：** 如果 DMA 要读取主存数据发送到外设，而主存数据是旧的（新数据在 Cache 中未回写），则必须先将 Cache 中的脏数据**刷回（Flush/Clean）**主存，或者通过硬件支持让 DMA 直接从 Cache 读数据。

---

### 知识点五：不同总线仲裁方式的特点

**【模拟题】**
在总线仲裁中，如果系统要求具备很高的灵活性，能够通过软件方便地修改设备的优先级，应采用哪种仲裁方式？
A. 链式查询方式 (Daisy Chain)
B. 计数器定时查询方式 (Polling)
C. 独立请求方式 (Independent Request)
D. 分布式仲裁方式

**【参考答案】** **B**

**【解析】**
*   **A 链式查询：** 优先级由硬件连线顺序决定（离控制器越近优先级越高），固定不可变，结构最简单，但对电路故障敏感。
*   **B 计数器定时查询：** 也就是轮询方式。总线控制器通过一组地址线向设备发出查询信号。**关键点：** 计数器的初值可以由软件设置。如果初值设为 $0$，则是循环优先级；如果初值设为上一次响应的设备号+1，则是循环优先级；如果初值固定，则可以设定某种固定优先级。因此它**灵活性最强**。
*   **C 独立请求：** 速度最快，但硬件最复杂（线数多），优先级由控制器内部的排队逻辑决定，虽然也可以编程，但通常 B 被认为是利用计数器初值改变优先级的典型代表。

---

**总结建议：**
这五个知识点中，**计算 CPU 利用率（DMA vs 中断）** 和 **DMA 下的 Cache 一致性/虚实地址** 是最容易结合实际场景出大题的地方，请务必掌握其背后的原理。RAID 计算通常比较死板，记住公式即可。